graph TD
    subgraph Client [Browser Extension]
        User[User] -->|Navigates| Browser[Browser Tab]
        Browser -->|URL Update| BG[Background Service Worker]
        BG -->|Check Cache| Cache[Local Storage Cache]
        
        Cache -- Hit --> BG
        Cache -- Miss --> API_Req[API Request]
        
        BG -->|Update Icon/Badge| UI[Browser UI]
        BG -- Phishing Detected --> CS[Content Script]
        CS -->|Overlay Warning| Browser
        
        Popup[Popup UI] -->|Get Stats/Details| BG
    end
    
    subgraph Server [Local API Server - Python/FastAPI]
        API_Req -->|POST /predict| API[FastAPI Endpoint]
        
        API -->|1. Extract Features| FE[Feature Extractor]
        FE -->|Raw Features| Scaler[Feature Scaler]
        
        Scaler -->|Scaled Features| ML_Ensemble[ML Ensemble]
        API -->|2. Tokenize URL| Tokenizer[URL Tokenizer]
        Tokenizer -->|Encoded URL| DL_Ensemble[DL Ensemble]
        
        subgraph Models [Model Inference]
            ML_Ensemble --> XGB[XGBoost]
            ML_Ensemble --> RF[Random Forest]
            
            DL_Ensemble --> CNN[CharCNN]
            DL_Ensemble --> LSTM[BiLSTM]
            DL_Ensemble --> Trans[Transformer]
        end
        
        XGB & RF & CNN & LSTM & Trans -->|Probabilities| Voter[Voting Mechanism]
        Voter -->|Final Verdict| Response[API Response]
    end
    
    Response -->|JSON Result| BG
    BG -->|Save Result| Cache
